# ИКНТ, Мальцев Даниил – группа ИТ18. Отчёт по лабораторной работе №6: Модификация представлений и реализация INSTEAD OF триггеров

### **1. Цель работы**

Цель работы - спроектировать базу данных, содержащую отношение типа «многие-ко-многим», создать представление, скрывающее идентификаторы таблиц, и реализовать триггеры INSTEAD OF для обеспечения корректной вставки, обновления и удаления данных через это представление.

Особое внимание уделяется:
+ корректному возврату значений в триггерных функциях при работе с представлениями;
+ недопущению повторных поисков одних и тех же данных;
+ тестированию корректности реализации всех операций.

<p>&nbsp;</p>

### 2. Структура базы данных

Модель включает три таблицы:
+ Readers - читатели
Содержит персональные данные: фамилия, имя, отчество и адрес.

+ Books - книги
Содержит автора, название, год и залог за книгу.

+ Subscription - связь M:N
Определяет факт получения книги читателем.
Помимо внешних ключей содержит атрибуты: дата выдачи и дата возврата.

Таблицы реализуют классическую структуру связи многие ко многим (читатель - книга) через таблицу-связку.

<p>&nbsp;</p>

### 3. Представление
Создано представление subscription_view, которое объединяет данные читателей, книг и связки, но не включает первичные ключи (reader_id, book_id, issue_id).

Задача: предоставить пользователю логически цельное отображение данных без технических идентификаторов.

<p>&nbsp;</p>

### 4. Реализация триггеров
Поскольку представление не хранит данные, операции INSERT, UPDATE, DELETE должны быть перенаправлены в базовые таблицы. Для этого используются триггеры INSTEAD OF.

Все триггерные функции корректно возвращают NULL, что соответствует требованиям PostgreSQL для представлений без собственных строк хранения.

### 4.1. Триггер INSERT
Функция:
1.Ищет существующего читателя по комбинации текстовых полей.
Поиск выполняется один раз, избегая дублирования выражений.

2.Если читатель не найден - создаёт запись и возвращает идентификатор.

3.Аналогично обрабатывает книгу.

4.Создаёт новую запись в таблице-связке.

5.Возвращает NULL.

Функция корректно реализует следующее поведение:

*пользователь может вставлять новые строки в представление, не заботясь о существовании связанных данных - система обеспечит целостность сама.*






















